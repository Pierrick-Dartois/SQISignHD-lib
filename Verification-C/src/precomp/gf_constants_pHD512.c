#include <stddef.h>
#include <stdint.h>
#include <tutil.h>
#include <fp2.h>
#include "gf_constants.h"

const fp2_t NQR_TABLE[20] = {{{0x8b26e191645fe5a,0x430a2d3f7247bcaf,0x5505ba1790ebed85,0x8e24156506c7bdac,0xe6109dfa59267ae7,0x851cf3e82aacf7d8,0x344c448766b48cec,0x609eb54a2893d658}, {0x713aaa37d2ba7ace,0x1d88910f285ba05f,0xcca3720970a11a19,0x1b4cb58c3c3ef045,0x51cf25eaec9d9ffe,0x9935a68c93c271aa,0xd1ae7423f832d837,0x482209f448105125}}, {{0x919100a36d9d0d3e,0x622434651a7fcb8d,0x3ab83671eaef3f8f,0x2d9c28435b4adfee,0x56ce3859caa43693,0xa4feb3af5d0acd20,0xc483153f7a14686a,0x2d80df92364ea0e1}, {0x513d8ab0ced77d43,0xcf5fde9f9f6a1d1,0x3e5ca0245a95541d,0x92f0ba57379c6dc3,0xace21ce8fe1803ad,0x1a1dfbb2d42f1dab,0x67c26f08ccb686cb,0x263b272d13dc5640}}, {{0xb6f26ffda80f2d7c,0x71b348caf02c0d0d,0x484792b2d73e25d4,0x99ad8b90211099ec,0x9aac0d4c3654ddcd,0xa5c77a4878c27521,0x27ade7b558e58e42,0x7b898a96b25c3fb2}, {0x8995caed006e3820,0xf7b3c5f3f7659f96,0xd03730af1ad0ae63,0x4533fb8700190716,0x3fe3bd9f4663b92f,0xb572d1a71ecf51f9,0x821e1783d3143d6d,0x932c60d6e2d1bebd}}, {{0xa683b5a9e5569ea7,0x84ddb1bcad43b862,0x47da183791eb8c92,0xd9822a400bff6962,0x8e466031f533a4f7,0x640b6842f8ca1248,0xffe59048005b510d,0x46cf5911e9815615}, {0x3f27585cca9d2547,0xaad0753272312881,0x2c0e85c797879cb6,0xd8572aa9e6644ca1,0xceff0fad8771bf4b,0xb20b16a6f75d5d29,0x212fa730e08bd6d7,0x8cf2d4f60536eb96}}, {{0x47408948434262ce,0x39c3615ca52c8d30,0x84e2f1860b3619a5,0xc5d05e482747ca8d,0xb4b3be5c79b732e3,0x25281f98ed45ee5,0xfaf4210e5fad3994,0x11c53689515b4a82}, {0x1fa43eb2922115c8,0x5c9dce08f1854ea4,0xa6a0f973349d2e7c,0xfeb1378870b131f,0x9134edf3d0ada69e,0xeaa036d836c5f624,0xa636e706aa634df9,0xa0a09e6b9c5b2324}}, {{0xeff8d361c8cae7bf,0x284453b3762c0411,0x895cd8091a68341a,0x8892578df2d41ad2,0xa96b92fb88fc848d,0x7c61afa06f5d4d8,0x524f64763e9b8565,0x638955e7b389430a}, {0x6818913103a384b,0x2f619f723249828c,0x929852af163c3faf,0x6b04218f2f922c48,0x48ce472d182dadb4,0x34013441fc19b81,0xd98a392d9322137e,0x2fbf687b28a83b99}}, {{0x47259e779c370384,0x7af5c60476430dd2,0x93b600e9abeb375d,0xd999554f303a3492,0x94f5490b08800e1d,0xa51e36d0c884b894,0x32c82d2fa6743f89,0x49996325483f7652}, {0xdbe4e8c4c1ac782b,0xb8b5e0c762f64f4a,0xf1fa973ad8bcd693,0xcbe3e42e7daee8f7,0x300d072ea2320329,0x9e2d8df148d1e8b6,0x4c8cce1710ebf4cd,0x4ae5fb9b741fdc6a}}, {{0x5fab27d5098a859f,0x4cf10110cd3a08bc,0x6368acc14c853c9d,0xc8635fcc1ecee6ae,0xef4078492011a989,0x6b65c43d7344ed34,0xc6b8307436ac83b8,0x9e158496d50f8cbc}, {0xab851d08dac715d4,0xcb9dffa8cc682f37,0x609c57a55b5d6a2b,0xfecf7e1691e7f70c,0xb2355f18b530ceb,0x6bbdb0ab2cb98fc1,0x877e95a63795158e,0x4ba9ed1ec1836ce}}, {{0x516b44312195485e,0x961277e0264a87f9,0x65a11b6e58a4a1ae,0xd14591a2fe60a39b,0xfbfa5262a674805d,0x3b410d4854f67dd9,0x422598087a186aae,0x734bee19c84b4e4}, {0xce5e8b7ed41f6e43,0xdecc0f18b54349f3,0xa8a5f4e5dc5431e1,0x64ff5499fa60f87a,0xddd608cc721ef2b8,0xd8e4c9ad58064af3,0xe28a5ae02074b92c,0x91d8a57336e37ac0}}, {{0x9a2b367554f425d7,0x3f0c0a790591948d,0xdc31df2efe5f8f51,0x833af919000aa596,0x4c57fe56659da96c,0x4d9ed0c8e8103524,0xfb4dea71b18388e5,0x8cf1d897bab7292}, {0x4e700cc745c74664,0xe8782666db11aee,0xc1e46737a1d149be,0x549dc7c088f9ed38,0xf22bc9356c06fb40,0x1e136c45091b4f4,0xd0b336ae01ccc151,0x64288a2272246026}}, {{0x15c77cfdb58c95d8,0x5a099ed2a85f1ce,0x708b141768908eb9,0xa6df902f9bfcd079,0x2d49b1515ed13662,0x6084229939f935ea,0x5c9a291ae7a81252,0x63438a4bac3cfb2c}, {0xa287b5b72741d458,0x3195e62f94f93587,0xfeac4616e3c28d54,0x3ffb51da2b8b56aa,0x508400fa175e958d,0x22e008306507405e,0xaa954a2f64d04ac9,0x268d6e3b71a59c3c}}, {{0x4aef3fde7a8c8765,0xd7657058766aba6f,0xd716ed0a376e6f98,0xa93471ae130fc5bf,0x82368085adad404d,0xe3910cc26c6e52b7,0x6fb24e0c38927f9e,0xa21ce326a62baef0}, {0xda846f263daee66,0xe8a44a81b26232,0x523719e7587dc753,0x6dfc0ed0999eea65,0xab37e910f90dee56,0x84514fd59ed779e1,0x203f7d68b31d3c4e,0x263ce574a53ac22b}}, {{0x822eff1def9018fb,0x6742d474bbcbffa,0xcf46d0a50800eea3,0x93e63e1daa1f2b73,0x6cc34c7ddef1af65,0xc82c9c776d4307ff,0xe774f8d3b20b9933,0x6a3ffb71e5b0c578}, {0x28ef4d28c03451b9,0xad9094aacc21654d,0xcf7d6503a167aa21,0x8d2a00647a933f81,0x9ad19391f8b55dad,0x4929f75b94e341c1,0xa9e9bd7629f49a1a,0x89b87c1ebf57db3e}}, {{0xba5d464f4e730d2a,0x85eb430b34517edb,0xe49fdabbff47101f,0x304c884b74854207,0x2b2da2add0f5bc9b,0xe12d72f714384342,0x5800e74097acd307,0x56f1d1861c1a74ba}, {0x4f7b1937d4aa8e6a,0x66dc35628b7f9e1b,0x3f3ab9cd600cebb6,0x5a0e2923a13f163b,0x5d6c6b653dba3ee5,0xbd59b5abc9b149db,0xb1b8efe436f9aec4,0x4eaf9aacbf9787e8}}, {{0x1ff143f14018144a,0x514d4039ffe8b6ae,0x74527a0de9c15950,0x11cb4f8af9259e3f,0xf51cb233a005be39,0x82706321b2ef62a5,0xa51f8b7d7e107e13,0x148e9d3e432140e6}, {0xd14365e9776ed8c1,0x52cf63d582fa601a,0x46a8c257636ed7ba,0xc94ee7b1d25c37f2,0x71100d7a0e730ed0,0xd874d8b380357b1,0xb5323c0f5c1375cc,0x88cc98e45291b902}}, {{0x1c84e86b8b58cfe4,0x720b0a41735b1102,0x825d3f6189f102bb,0x73b8d282df0483fe,0xf48e72c54384c695,0x9e45961471535682,0xb5c1eed7c77b500a,0x948b3488997de600}, {0xe43900068e00d148,0x7853654bc5afde18,0xe9285fdc50e5eae7,0x933c461739de4ec7,0x3515efe3ba29086c,0x7d11c68a2b4fc7ee,0xc60f8cda78c9f8d1,0x4ed8bd3eae0900dc}}, {{0xfdefc68a3bd93853,0xb2ab9ddf3dfa1b82,0x902059426a19d7c1,0xc96a71ef29515e45,0x396f00cba093fff8,0x6e3cf1200c350f2b,0x787ab9d44d6206ac,0x57be716daa1c412e}, {0xb5dd59c8c0cb87f2,0x22e029c0b4d1c174,0xd108f6250dc9ac4,0xc58c55858ed6c45a,0x1e0ecab68a734c21,0xfd016ede9ea6decd,0xfd46cfe231397464,0x880b07a89b8268b3}}, {{0xc7d384b5c4832e7b,0xed59ae8e133566cb,0x1eeb470116196b0b,0x6f56a0f820403bfd,0xde1815ca1b45fe9,0xc8259b43022a1bda,0xff9d792b0d8a7d01,0x572cdc9c3abfd3f4}, {0x6f8e0cb2d9e30a07,0x490ea32f86f49395,0x342f9904238f99a7,0x4dd9d4c54e9bc077,0x7a1d118774261b17,0xb785e2227d9d0deb,0x1827d6ec2704a240,0x9b1f500941042ac0}}, {{0x674a7d173592e7d3,0x5069dae4d062e,0x1a4368fd74f5db43,0x70d839cefd40a09e,0x5037fb8ad47d29a9,0xda528b11f3a00ad,0x73eb8f33a55dd7f1,0x197e009115679c28}, {0x12525bf1917ee4f3,0x1f1dd3c5ec45efa2,0xed8b687cb0bfe762,0x7780a1a2787db334,0xb640c5dff8922cf0,0x37800903b892c258,0x4c818bb6fc839cb1,0x9e7dda569014b0cb}}, {{0x1b9ae42e46ccba42,0xc8a3d033a5008d26,0x28a516428b3e7094,0x8c0861292d483df4,0xe74a800ee08a2955,0xcb8158c61867f643,0x3ce00a79979184c8,0x9c45ede9674f0a58}, {0xad3b88d8d6fdbb4c,0xb77791a9a69acb9c,0xa6271e78002b5092,0xd36be3751f66023f,0x2909fdb829f8ed9,0xc9bc5939456e9b7b,0xc494f30daee877a7,0x25d849d190250682}}};
const fp2_t Z_NQR_TABLE[20] = {{{0x23ff3675f034a661,0xb589fb0e481f884,0xb5efbe877c5e8b79,0xbad8d12f9003611d,0x92ec8d41aa46756a,0xcdf411cc86368a4f,0xc61c2bbd1495ab2e,0x6f46f98bb90e88e6}, {0xf16a07b850f70c49,0xeb2fb8f728df55c2,0xe43925d1be7fe910,0x19bb0f71ee0f079e,0xfe7efd153d776b3,0x4d9767221a3ea626,0xfdb823fa9b199150,0x4ef498ad7e3a2745}}, {{0xaf8b2437d4e2725d,0xc3044a8bb2d10d1e,0x892a6b9ff43d280f,0xd4ebd6cce97105eb,0x96125e5cda064385,0x77995a57f8e08e69,0x414a8f0353263604,0x8e86b84e11c56173}, {0x1bff93b3abeb8e74,0x7b9f29ca377f0b2,0x6398470de8fe9d54,0x3f980bdc36a09a03,0xba7c1a4ab48f0381,0xe50107dfc8d9f2bd,0xc4210d21aa30238b,0x6d368c0c4330105d}}, {{0xd46ba6f447993705,0xaf7f134f0be06649,0x6d7e36fe3a2fecb0,0xd57c5224a5abdf92,0x23b73c6f86803cc5,0xf8c4eddfa85d7290,0xe0deb414deadd676,0x4e9d40eedcd1def9}, {0x4c7b7bb9b9c8236e,0x18f43fc42ab669b5,0x9787ee4d7697fdcb,0xe5d8288b44e3820,0x4aa142cd2c7490b7,0xfa10bf0946459185,0x52062d8a17eb96ab,0x885aa6778c56d4be}}, {{0x94e0a73c2e944a34,0x144c94ae151e51ec,0x52d98c1f48d798f2,0x1e138f87d627de47,0x71cd346467a51082,0x1d0d1553b2e3186b,0x321ddccc10de7a88,0x82cf94b1b059074d}, {0xe491950f7f1f9082,0x7d476d46895b114d,0xf0b2420eff11d74e,0x22efb4d6c7a9a853,0x5dff2ea810e32b63,0x11405664320b4bbd,0x57a12808ce00389c,0x676c0c1c962af97b}}, {{0x34cfbe430348796b,0x9772a55695ce6e92,0xa2e5618bf6e1c7e1,0x67c5ab2359ed6a44,0x660a587640849a96,0xf82088ceeb24302d,0xdeff0f58ba08856f,0x5e40e7cedc7516bc}, {0x14f3f7cf10633c60,0x21c6058ca70db58d,0x9a724126671a3b51,0x7cd84d9ecaa177cf,0xb0c1f6bc79b2e32d,0x78e007f000612149,0x8772ce01500644e2,0x7737c57ac889001a}}, {{0xdfe76a8f84e76d34,0xd0295b5eecae5281,0x73614c3c51641e,0x44e2aa8d59a6ddf0,0xfdbc42374e77c4e7,0x4906a04e7375081d,0x1c363c0e90d3dac7,0x8c8b45a462201e50}, {0xf72939de6687a0ee,0x9eb250f7274d4b63,0x15a262cee2980a8d,0xadc8389a6e321df2,0xc91c492311b25c56,0x9e1f5c2228e9de97,0x191b48d4a2bf3905,0x4b0f5be24e85b019}}, {{0x497d163b77817107,0x50721ed9ef68bf6e,0xf2e2d8e5a3f22de1,0xb1997828acd57f43,0x7904b56ce273e476,0xdd582ac5a936710b,0x30d7257260249164,0x629201255fc46389}, {0x690371602f4376c7,0xab7ddef6b4b063f0,0xe54824ca07b4e139,0x24ca83303075d6c9,0x6473901797d809b8,0x1bd6fe7288a7022e,0xa54506f0ed1ed192,0x4d6d6d0a08ad9815}}, {{0x2f65bae2d9c6498f,0xe40adf5104f8f2f4,0x279154a6cfd0d85e,0xdd3df5d0c78676c,0x3ba5fbc9ee9ad962,0x48eed7a09b9bf4e3,0x2eb4ff2b91a327a0,0xa29d4a3f1e65beb0}, {0x5fc436b7cf60db6d,0xc85bd5e5dfef371,0x813b2fd65bb3c8f2,0x1442686caa4c5b1,0x394ee6eb91aa876e,0xddbf091ce2288fdd,0x736da4ef5ae916b,0x3ba19475efd99ca8}}, {{0xe6893b51356a55eb,0xb604404bed7f574c,0x2cc494b6cc9cb985,0xbda4c136fe020ebc,0xfc6af4e306d6bb0b,0x243210bc8dcf75fa,0x6c3e14f0bfe2d157,0x27d5db1f6c2fca79}, {0x4b8bedbdf7a24d64,0xf910a76bbf656bd7,0x775dd4153282200c,0x3dba8a92bc7f8c6b,0x7c1e11bedd95c85d,0xfb1c6808576758b,0xdfab5efd6831dc9,0x953f5a81d7b823d2}}, {{0xedbdf698f26c4947,0x8aa6865a1d6b50d,0x5a42fb44db848d80,0xcceeb72e4b69dac7,0x8403f73a7b72e9f,0xf5c18f992fb01739,0xa7e7455b26d5b69,0x976ce8417102dbfd}, {0xb92b07d06dcbd454,0x179af3e5da805d8a,0xe0cbee13bdc8c119,0x1630e93e36c73a78,0xa2c6107609325ce6,0x3ca122d46a6fd286,0xc2255776479181b6,0x62e466f1b08e89bd}}, {{0xe04d65a15284b00a,0x4994f875a174298e,0x2b3beeb88bf6e006,0xae3bbef3e2c10ce9,0x152fa857c4376ac7,0xbebfc1d54cb2f066,0x74292f3b55265a0d,0x48bf7d66db738063}, {0x8b144319a3c7f16f,0xfc456529e2addba6,0xe70d8efa3822f26f,0xecb8affc46e7ac37,0x1d818edd1c8d8270,0xf990dddf024e778d,0x5f3562e8267076cc,0x2a00d875ffa6f8d9}}, {{0x168f7e6490a7a437,0x146aef6753e294eb,0xcec307465de8980b,0x34e06a6e8f54e9b4,0xcfd3da61cdf67b70,0x64978265b72abbad,0xaee6f50a838fb553,0x89a4023643f56516}, {0x54515a8c5e5f2d78,0x25aa98e2015eab41,0xcb1a99bf4417ba24,0x6566316e2ccd9b45,0x6bebc5c96facebc4,0x50c10cd03b415978,0xc26d6846c3eb1fee,0x12ed2940590d0167}}, {{0x193a510a7d8c84d2,0xaba97b8e5b1508a2,0x25f5ebc5b13c5dd9,0x8d7ba8f083bc47c5,0xed8e2c6edb94204f,0x9e94d2843ed2096b,0xf70d2c33be1408cd,0x144cd20f671c7e63}, {0xc7f8f29a306d9b7f,0x1957a8065080a8fe,0x3cf4c7cdc434fbc8,0x7c2f3a9d2f7fbb63,0x65bdf0f89827aa4c,0x2abc9bd75faaa1ef,0xe9b978b764d2ce50,0x6b60b710362c353}}, {{0xf7d4a2ba082a248a,0xa186ad88912a41bf,0xbe80086717fd6d3d,0x602731757680b76c,0x3525a477f293396e,0x352b26162b4f863b,0x8c11bf0055c29ea6,0x241de752009ccf77}, {0x3a240fc8c2ab7665,0x284a5d5089176b8f,0x9b85b03495a432a,0x21768b3d995b2612,0x837b0912b54cd7fb,0x61b36b896351eb95,0x77efdbe7df40e088,0xa3305a1fdfe10790}}, {{0x5648f93ae0109cbe,0xdff6b433aab853e1,0xc01434a4ecf0e798,0xb10db9fbd0de4ead,0x2ff5c52e931d72b4,0x4765ab4fa5ae1ce4,0x1e48ce363660ba8a,0x89eecdc493d358aa}, {0x29306e9c9373bfac,0xb169a0f44bf9ce5d,0xc9b69b0eb7a886db,0x30190e40241df497,0x5e00b321ee123683,0xb015fb7461a1dc92,0xa4e468e4a2aedc77,0x57060ffe08e3fe49}}, {{0xed5f1532232ff233,0xfb1c53de64af8d93,0xcc07293cefe496fc,0x9c3b7db9b24b4920,0x148c805b11f8eba7,0x1db1fe4fa12546fb,0xab5a13f27aab654a,0x6be641f53f5ef32f}, {0xdd665d4f746529a8,0xabc6be1b69140dff,0x864824925d07a672,0x5d28b27c4479f7a,0x114fcb72b5726bfd,0x68649478f3ae82f1,0x1f3a01348e8e663f,0x1a1de0bd8d5e8df2}}, {{0xab94ded4aee08356,0x49e12a2266535cf8,0xf3a217525fede8b3,0xa53aca6a372a2396,0x50159f7875b90219,0xd6d21d2f8b79423b,0x8f90a89058853813,0x8c543b24bd42eeec}, {0x52def581335bac6f,0x3fd8e754aad8dc59,0x988c2ca2679087ab,0x84fb9ca5d73ffaba,0xeda25cc1cf1cd51d,0xada51367a86f7fab,0x71920a277fcd8b28,0x758939e5336ec58}}, {{0xdb13bdf076a92dd4,0x56da9d42553e98b7,0x16e521d94514af63,0x8d46fe75815be3d0,0x5310982d55a06ded,0xf3c2266b8e186a51,0x7d1f58db90a3cfb7,0x1edc6a0ed399bcb7}, {0x783b85e47a4db29f,0x6293703f16d4f893,0xe83a50efa93ae950,0xffc887664efafcef,0x8bf4412bbadf7334,0x257f5cc3ebb0086c,0x66a4397f7ad1a07a,0x118d35bc38a0676e}}, {{0x9d5a3177d0161e11,0x7f22c8bbf811712e,0xe73368b83161c672,0x190e6ca8c71a1c07,0x6879cbedaf2160f,0x17cccb4a788eb00f,0x5d93df9eb9e02d92,0x2f001334aef90db0}, {0x6ade8725127724b5,0xf7bb75a4f77d37f8,0xca2af6bcf0aeec61,0xe62930a06922239d,0x47383e2fce56460d,0xb178e93dbe5e3188,0xd9cf9501f1b9840d,0x51bb7ed36a34ed47}}, {{0x7ca502701f168148,0xe204f6af49506325,0xd2951caf94ccaf7d,0x9b300df97694bf4a,0xeb9dbaaee0d83e44,0xdfb2454e91721d0d,0x88bc91b9adc0bb9a,0x11906f9724afa2b0}, {0xc5bf6a87366f78de,0xb77dc1d6e48fadb6,0x3ce346d5b0ed8817,0x49875b1bf915db85,0xe0fa65b4b8e24799,0xb4d10d474bf1677e,0x60b08dcca12c2a7e,0x9ed7c453ce7a45a5}}};

const digit_t p_cofactor_for_2f[4] = {0x80429e2d58ebb467, 0x52e830945c1a0446, 0x5eec151f0a69c447, 0xa65f4ee938387923};

const digit_t p_cofactor_for_3g[5] = {0x0, 0x0, 0x0, 0x0, 0x1f};
const uint16_t P_COFACTOR_FOR_2F_BITLENGTH = 256;
const uint16_t POWER_OF_2 = 256;
const uint16_t P_COFACTOR_FOR_3G_BITLENGTH = 261;
const uint16_t POWER_OF_3 = 158;
